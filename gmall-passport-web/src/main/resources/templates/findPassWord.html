<!DOCTYPE html>
<html lang="en"  xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="/css/gm1.css"/>
		<script src="/../js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
		<title>密码找回</title>
	</head>
	<body>
		<!--顶部logo-->
		<header>
			<a href="#"><img src="/img/logo1.jpg"/></a><p>密码找回</p>
 
		</header>
		
		<div class="top-2">
			<div class="top-2a">
				 
				<p> </p>
			</div>
		</div>
		
		<!--大图-->
		<div class="top-3">
			<div class="img_1">
				<img src="/img/5731485aN1134b4f0.jpg"/>
			</div>
			<div id="sign">
 
				<div class="si_cen">
					<h2 class="act btn1">密码找回</h2>
				</div>
 
				<div class="si_bom1 tab" style="display: block;">
					<div  class="error" style="width: 205px;height: 20px" >
					用户名和手机号或者验证码不对应！
				</div>
					<form id="findPasswordForm" action="./userFindPassword" method="post">
					<ul>
						<li class="top_1">
							<img src="/img/user_03.png" class="err_img1"/>
							<input type="text" name="loginName" placeholder="用户名"  class="user" />

						</li>
						<li>
							<img src="/img/user_06.png" class="err_img2"/>
							<input type="text" name="phoneNum" placeholder=" 手机号" class="phoneNum" style="width: 150px">&nbsp;
							<input id="getMessage"  type="button" class="getMessage" onclick="getCode()"  value="验证码" style="height: 39px;width: 51px;margin-left: 6px;background-color: #b4afc7">
						</li>
					<li>
							<img src="/img/user_06.png" class="err_img2"/>
							<input type="text" name="code" placeholder="手机6位数验证码" class="code"/>
						</li>

						<li class="ent"><button id="btn2" type="button" class="btn2"><a class="a">找 &nbsp; &nbsp;回</a></button></li>
					</ul>
					</form>
				</div>
			<div class="si_out">

			</div>
			</div>
		</div>

		
		<!--底部-->
		 
		
	</body>
	<script language="JavaScript">

			
			var btn2=document.getElementsByClassName('btn2')[0];
	    	var sendMessage=document.getElementById("getMessage")[0];
			var user=document.getElementsByClassName('user')[0];
			var pass=document.getElementsByClassName('password')[0];
            var phoneNum=document.getElementsByClassName('phoneNum')[0];
            var codeNum=document.getElementsByClassName('code')[0];

			var err=document.getElementsByClassName('error')[0];

			var err_img1=document.getElementsByClassName('err_img1')[0];
			var err_img2=document.getElementsByClassName('err_img2')[0];
            var phone=phoneNum.value;
            var code=codeNum.value;
            var countdown=60;
			//获取验证码
       //     getMessage.onclick=function () {
function getCode() {

                if(!(/^1[34578]\d{9}$/.test(phoneNum.value))){
                    $(".error").text("手机号码格式有误，请重填！");
                    $(".error").show();
					//   alert("手机号码有误，请重填");
                    return ;
                }
           $.post("/getMessageNum",$("#findPasswordForm").serialize(),function (data) {
               if(data&&data!='fail'){
                   //sendMessage.attr("disable","disable");
                  // sendMessage.css("disable","disable")
				 //  alert("已经禁用")
				//   $("#getMessage").attr("disable","disable");
                   var obj = $("#getMessage");
                   settime(obj)
			   }else{
                   //    alert("验证失败!");
                   $(".error").text("发送验证码失败！");
                   $(".error").show();
               }
           });

            }
			//提交
			btn2.onclick=function(){
                   // var phone = phoneNum.value;
                    if(!(/^1[34578]\d{9}$/.test(phoneNum.value))){
                        $(".error").text("手机号码格式有误，请重填！");
                        $(".error").show();
                        return ;
                    }
				if(user.value == '' ||phoneNum.value ==''|| codeNum.value ==''){
					err.style.display='block';
					user.style.border='1px solid red';
					pass.style.border='1px solid red';
                    pass2.style.border='1px solid red';
					err_img1.src='img/img11.png';
					err_img2.src='img/img22.png';
				}
				else
				{

					/*$("#loginForm").serialize() 获取表单中的所有元素值*/
					/*alert($("#loginForm").serialize());*/
					console.log($("#findPasswordForm").serialize());
					/*ajax */
                    $.post("/userFindPassword",$("#findPasswordForm").serialize(),function (data) {
                       // debugger
                    if(data&&data!='fail'){
                          //  alert("验证成功！");
                        if(codeNum.value==data){
                            window.location.href="resetPassWord";
						}else {
                            $(".error").text("验证码无效!");
                            $(".error").show();
						}
                       // window.location.href="resetPassWord";
                       // window.location.href="userResetPassWord&"+$("#findPasswordForm").serialize();
                            return ;
                        }else{
                        //    alert("验证失败!");
                             $(".error").text("用户名和手机号或者邮箱不对应！");
                             $(".error").show();
                        }
                    }   );
                }
			 return;


				}
			 user.onfocus=function(){
                 
                user.style.border='1px solid #999';

		 }

            pass.onfocus=function(){
                
                pass.style.border='1px solid #999';
            }
            user.onblur=function(){
                 
                user.style.border='1px solid green';
            }
            pass.onblur=function(){
                
                pass.style.border='1px solid green';
            }


            function settime(obj) { //发送验证码倒计时
                if (countdown == 0) {
                    obj.attr('disabled',false);
                    //obj.removeattr("disabled");
                    obj.val("验证码");
                    countdown = 60;
                    return;
                } else {
                    obj.attr('disabled',true);
                    obj.val("(" + countdown + ")");
                    countdown--;
                }
                setTimeout(function() {
                        settime(obj) }
                    ,1000)
            }
	</script>
</html>
